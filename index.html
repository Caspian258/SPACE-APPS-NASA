<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Asteroid Impact Simulator — Hackathon</title>
  <!-- Leaflet CSS (CDN). Nota: si tu entorno no tiene Internet, copia leaflet.css a static/vendor y referencia local -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="static/css/style.css" />
</head>
<body>
  <header>
    <h1>Asteroid Impact Simulator</h1>
    <p>Explora el impacto de asteroides y estrategias de mitigación.</p>
    <!-- Botón (imagen) para abrir el Visor de Asteroides -->
    <button id="openAsteroidViewerBtn" class="icon-button" title="Abrir visor de asteroides">
      <img src="./static/img/asteroid-icon.png" alt="Abrir visor de asteroides" />
    </button>
  </header>

  <main id="simLayout" class="layout">
    <!-- Control Panel -->
    <section class="panel control">
      <h2>Panel de Control</h2>
      <div class="control-group">
        <label for="diameter">Diámetro del Asteroide (m)</label>
        <input type="range" id="diameter" min="10" max="1000" step="1" value="100" />
        <div class="value" id="diameterValue">100 m</div>
      </div>
      <div class="control-group">
        <label for="velocity">Velocidad del Asteroide (km/s)</label>
        <input type="range" id="velocity" min="10" max="70" step="0.1" value="20" />
        <div class="value" id="velocityValue">20.0 km/s</div>
      </div>
      <div class="control-group">
        <label for="density">Densidad (kg/m³)</label>
        <input type="number" id="density" min="500" max="8000" step="100" value="3000" />
      </div>

      <div class="control-group">
        <label>Selecciona el punto de impacto</label>
        <div id="selectMap" class="map-select"></div>
        <div class="value small" id="impactCoords">Lat: ---, Lon: ---</div>
      </div>

      <div class="control-group">
        <label for="mitigation" class="tooltip">Velocidad de Deflexión (km/s)
          <span class="tooltiptext">Un impactador cinético es una nave que golpea al asteroide para cambiar ligeramente su velocidad y trayectoria.</span>
        </label>
        <input type="range" id="mitigation" min="0" max="0.1" step="0.001" value="0" />
        <div class="value" id="mitigationValue">0.000 km/s</div>
      </div>

      <button id="simulateBtn" class="simulate">¡Simular Impacto!</button>


      <div class="toggle-views">
        <button id="show3D">Ver Globo 3D</button>
        <button id="show2D">Ver Mapa 2D</button>
      </div>

      <div class="control-group" style="margin-top:12px;">
        <label>Catálogo de objetos</label>
        <div class="radio-group" style="display:flex;gap:12px;flex-wrap:wrap;">
          <label style="display:flex;align-items:center;gap:6px;">
            <input type="radio" name="datasetMain" value="asteroids" checked /> Asteroides
          </label>
          <label style="display:flex;align-items:center;gap:6px;">
            <input type="radio" name="datasetMain" value="comets" /> Cometas
          </label>
        </div>
      </div>

      <div class="control-group">
        <label for="objectSelect">Seleccionar objeto</label>
        <select id="objectSelect" style="width:100%;padding:8px;background:#0b1526;color:#e8eef5;border:1px solid #22304a;border-radius:6px;">
          <option value="">Cargando catálogo...</option>
        </select>
        <div class="value small" id="objectSummary">--</div>
      </div>

      <div class="control-group" style="margin-top:12px;">
        <label for="filterName">Buscar por nombre</label>
        <input type="text" id="filterName" placeholder="Ej: Apophis" style="width:100%;padding:8px;background:#0b1526;color:#e8eef5;border:1px solid #22304a;border-radius:6px;" />
      </div>

      <div class="control-group" style="margin-top:6px;display:grid;grid-template-columns:1fr 1fr;gap:8px;">
        <div>
          <label for="filterMinDiameter">Diámetro mínimo (km)</label>
          <input type="number" id="filterMinDiameter" min="0" step="0.1" placeholder="0.0" style="width:100%;padding:8px;background:#0b1526;color:#e8eef5;border:1px solid #22304a;border-radius:6px;" />
        </div>
        <div>
          <label for="filterMinVelocity">Velocidad mínima (km/s)</label>
          <input type="number" id="filterMinVelocity" min="0" step="0.1" placeholder="0.0" style="width:100%;padding:8px;background:#0b1526;color:#e8eef5;border:1px solid #22304a;border-radius:6px;" />
        </div>
      </div>

      <div class="control-group" style="margin-top:6px;">
        <label>Rango de fechas de descubrimiento</label>
        <div style="display:flex;gap:8px;flex-wrap:wrap;">
          <input type="date" id="filterDateStart" style="flex:1;padding:8px;background:#0b1526;color:#e8eef5;border:1px solid #22304a;border-radius:6px;" />
          <input type="date" id="filterDateEnd" style="flex:1;padding:8px;background:#0b1526;color:#e8eef5;border:1px solid #22304a;border-radius:6px;" />
        </div>
      </div>
    </section>

    <!-- Visualization -->
    <section class="panel visualize">
      <div id="globe3D" class="viz"></div>
      <div id="map2D" class="viz hidden"></div>
    </section>

    <!-- Results Panel -->
    <section class="panel results">
      <h2>Resultados</h2>
      <ul class="results-list">
        <li><strong>Energía de Impacto:</strong> <span id="energy">--</span> Megatones</li>
        <li><strong>Diámetro del Cráter:</strong> <span id="crater">--</span> km</li>
        <li><strong>Magnitud Sísmica Estimada:</strong> <span id="magnitude">--</span> Richter</li>
    <li><strong>Probabilidad de Impacto por Órbita:</strong> <span id="impactProbability">--</span> %</li>
      </ul>

      <div class="neo-picker hidden" id="neoPicker">
        <h3>Selecciona un NEO</h3>
        <div class="value small">Fuente: NASA NeoWs (demo)</div>
        <select id="neoSelect" style="width:100%;margin:8px 0;padding:8px;background:#0b1526;color:#e8eef5;border:1px solid #22304a;border-radius:6px;"></select>
        <div class="value small" id="neoDetails">--</div>
        <div style="display:flex;gap:8px;margin-top:8px;">
          <button id="applyNeo" class="simulate" style="flex:1;background:#2a7de1">Aplicar</button>
          <button id="closeNeo" class="simulate" style="flex:1;background:#444e5f">Cerrar</button>
        </div>
      </div>
    </section>
  </main>

  <!-- Visor de Asteroides (oculto por defecto) -->
  <div id="asteroidViewer" class="viewer hidden">
    <div class="viewer-header">
      <h2>Visor de Asteroides</h2>
    </div>
    <div class="viewer-grid">
      <!-- Columna Izquierda: Controles e Información -->
      <div class="viewer-left">
        <div class="control-group" style="margin-top:0;">
          <label for="modeToggle">Modo</label>
          <button id="modeToggle" class="toggle">Modo Manual</button>
          <div class="value small">Pulsa para alternar entre Manual y API</div>
        </div>

        <!-- Controles: Modo Manual -->
        <div id="manualControls">
          <div class="control-group">
            <label for="manDiameter">Diámetro (km)</label>
            <input type="range" id="manDiameter" min="0.1" max="1000" step="0.1" value="50" />
            <div class="value" id="manDiameterValue">50.0 km</div>
          </div>
          <div class="control-group">
            <label for="manSpeed">Velocidad (unid.)</label>
            <input type="range" id="manSpeed" min="0" max="60" step="0.1" value="10" />
            <div class="value" id="manSpeedValue">10.0</div>
          </div>
          <div class="control-group">
            <label for="manDensity">Densidad (kg/m³)</label>
            <input type="range" id="manDensity" min="500" max="8000" step="100" value="3000" />
            <div class="value" id="manDensityValue">3000 kg/m³</div>
          </div>
          <div class="control-group">
            <label for="manRotation">Rotación (°/s)</label>
            <input type="range" id="manRotation" min="0" max="30" step="0.1" value="5" />
            <div class="value" id="manRotationValue">5.0 °/s</div>
          </div>
        </div>

        <!-- Controles: Modo API -->
        <div id="apiControls" class="hidden">
          <div class="control-group">
            <label>Fuente de datos</label>
            <div class="radio-group" style="display:flex;gap:12px;flex-wrap:wrap;">
              <label style="display:flex;align-items:center;gap:6px;">
                <input type="radio" name="datasetViewer" value="asteroids" checked /> Asteroides
              </label>
              <label style="display:flex;align-items:center;gap:6px;">
                <input type="radio" name="datasetViewer" value="comets" /> Cometas
              </label>
            </div>
          </div>
          <div class="control-group">
            <label for="apiAsteroidSelect">Lista de asteroides (catálogo)</label>
            <select id="apiAsteroidSelect" style="width:100%;padding:8px;background:#0b1526;color:#e8eef5;border:1px solid #22304a;border-radius:6px;"></select>
          </div>
          <div class="control-group">
            <label for="apiAsteroidDetails">Detalles</label>
            <textarea id="apiAsteroidDetails" rows="6" readonly style="width:100%;padding:8px;background:#0b1526;color:#e8eef5;border:1px solid #22304a;border-radius:6px;resize:vertical;"></textarea>
          </div>
        </div>
      </div>

      <!-- Columna Derecha: Visualización 3D -->
      <div class="viewer-right">
        <div id="asteroidCanvas" class="viz"></div>
      </div>
    </div>
  </div>

  <footer>
    <small>Datos: NASA APIs y USGS (simulados). Este simulador es educativo y simplificado. (Front-end standalone)</small>
    <!-- Botón para modo amigable para daltónicos -->
    <button id="color-toggle-btn" class="footer-icon-button" title="Modo daltónico">
      <img src="./static/img/accessibility-icon.png" alt="Accesibilidad" />
    </button>
  </footer> 

  <!-- Leaflet JS (CDN) -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <!-- Three.js UMD estable para file:// (r149) -->
  <script src="https://unpkg.com/three@0.149.0/build/three.min.js"></script>
  <script src="https://unpkg.com/three@0.149.0/examples/js/controls/OrbitControls.js"></script>
  <script src="./database.js"></script>
  <script src="static/js/script.js"></script>
</body>
</html>
